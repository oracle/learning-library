/*
Author: Ashwin Agarwal
Version: 21.1
Last updated: 18-May-2021 by Ashwin Agarwal
Changes:
- Pick workshop and lab name from manifest instead of HTML.
- Introduced idle time of 20 seconds for time spent calculation.
*/

"use strict";$.getJSON(window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"/manifest.json",function(i){let n=0;if(-1==$.inArray(window.location.origin,["https://oracle.github.io"]))return;let o=function(){var i,n,o,e=navigator.appVersion,r=navigator.userAgent,t=navigator.appName,s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);-1!=(n=r.indexOf("Opera"))&&(t="Opera",s=r.substring(n+6),-1!=(n=r.indexOf("Version"))&&(s=r.substring(n+8))),-1!=(n=r.indexOf("OPR"))?(t="Opera",s=r.substring(n+4)):-1!=(n=r.indexOf("Edge"))?(t="Microsoft Legacy Edge",s=r.substring(n+5)):-1!=(n=r.indexOf("Edg"))?(t="Microsoft Edge",s=r.substring(n+4)):-1!=(n=r.indexOf("MSIE"))?(t="Microsoft Internet Explorer",s=r.substring(n+5)):-1!=(n=r.indexOf("Chrome"))?(t="Chrome",s=r.substring(n+7)):-1!=(n=r.indexOf("Safari"))?(t="Safari",s=r.substring(n+7),-1!=(n=r.indexOf("Version"))&&(s=r.substring(n+8))):-1!=(n=r.indexOf("Firefox"))?(t="Firefox",s=r.substring(n+8)):-1!=r.indexOf("Trident/")?(t="Microsoft Internet Explorer",s=r.substring(r.indexOf("rv:")+3)):(i=r.lastIndexOf(" ")+1)<(n=r.lastIndexOf("/"))&&(t=r.substring(i,n),s=r.substring(n+1),t.toLowerCase()==t.toUpperCase()&&(t=navigator.appName)),-1!=(o=s.indexOf(";"))&&(s=s.substring(0,o)),-1!=(o=s.indexOf(" "))&&(s=s.substring(0,o)),-1!=(o=s.indexOf(")"))&&(s=s.substring(0,o)),a=parseInt(""+s,10),isNaN(a)&&(s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10));var l=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(e),d=!!navigator.cookieEnabled;void 0!==navigator.cookieEnabled||d||(document.cookie="testcookie",d=-1!=document.cookie.indexOf("testcookie"));var u="-",c=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Chrome OS",r:/CrOS/},{s:"Linux",r:/(Linux|X11(?!.*CrOS))/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var w in c){var p=c[w];if(p.r.test(r)){u=p.s;break}}var f="-";switch(/Windows/.test(u)&&(f=/Windows (.*)/.exec(u)[1],u="Windows"),u){case"Mac OS":case"Mac OS X":case"Android":f=/(?:Android|Mac OS|Mac OS X|MacPPC|MacIntel|Mac_PowerPC|Macintosh) ([\.\_\d]+)/.exec(r)[1];break;case"iOS":f=(f=/OS (\d+)_(\d+)_?(\d+)?/.exec(e))[1]+"."+f[2]+"."+(0|f[3])}return{os:u,osv:f,br:t,brv:a+" ("+s+")",mob:l,coo:d,scr:0,ua:navigator.userAgent}}(),e=function(i){return 1==i?Math.random().toString(36).substr(2,8):2==i?Date.now().toString(36)+Math.random().toString(36).substr(2,8):3==i?Date.now().toString(36)+Math.random().toString(36).substr(2,8)+Math.random().toString(36).substr(2,8):void console.log("Byte value not defined!")},r=function(i,n){return sessionStorage.setItem(i,n),s(i)},t=function(i){return window.localStorage.getItem(i)},s=function(i){return sessionStorage.getItem(i)},a=function(i){let n=window.location.search.substring(1).split("&");for(var o=0;o<n.length;o++)if(n[o].split("=")[0]==i)return n[o].split("=")[1];return!1},l=function(){let n=a("lab");for(var o=0;o<i.tutorials.length;o++)if(n==i.tutorials[o].filename.split("/").pop().split(".md")[0])return n;return i.tutorials[0].filename.split("/").pop().split(".md")[0]},d=function(){let n=l();for(var o=0;o<i.tutorials.length;o++)if(n==i.tutorials[o].filename.split("/").pop().split(".md")[0])return i.tutorials[o].title;return i.tutorials[0].title},u=function(i,n){navigator.sendBeacon(i,new Blob([JSON.stringify(n)],{type:"application/json"}))},c=function(){return n=0,setInterval(function(){r("ll_duration",parseInt(s("ll_duration"))+1)},1e3)},w=function(i){let n={dur:s("ll_duration"),eve:i,vid:s("ll_view_id"),wid:s("ll_workshop_id"),uid:t("ll_user_id")};u("https://apex.oracle.com/pls/apex/ashwin-agarwal/livelabs/record_lab_change",n)},p=window.location.href.split("#")[0].split("?")[0];var f,g;p.includes(".html")||(p+="index.html"),null==t("ll_user_id")&&(f="ll_user_id",g=e(3),window.localStorage.setItem(f,g),t(f),function(){let i={uid:t("ll_user_id"),os:o.os,osv:o.osv,br:o.br,brv:o.brv,mob:o.mob,coo:o.coo,scr:o.scr,ua:o.ua};u("https://apex.oracle.com/pls/apex/ashwin-agarwal/livelabs/record_user",i)}()),null!=s("ll_workshop_id")&&p===s("ll_workshop_url")||(r("ll_workshop_id",e(2)),r("ll_workshop_url",p),function(){let n=i.workshoptitle;n=""==n?"<no title>":n;let o={wid:s("ll_workshop_id"),url:s("ll_workshop_url"),wor:n,ll:window.self!==window.top,ses:a("session"),rf:document.referrer,tz:Intl.DateTimeFormat().resolvedOptions().timeZone,uid:t("ll_user_id")};u("https://apex.oracle.com/pls/apex/ashwin-agarwal/livelabs/record_wkshop_view",o)}()),s("ll_lab_name")!==l()&&(s("ll_lab_url")==p&&w("labchange"),r("ll_lab_name",l()),r("ll_view_id",e(2)),r("ll_duration",1),r("ll_lab_url",p),function(){let i={vid:s("ll_view_id"),lab:s("ll_lab_name"),tit:d(),wid:s("ll_workshop_id"),uid:t("ll_user_id")};u("https://apex.oracle.com/pls/apex/ashwin-agarwal/livelabs/record_lab_view",i)}());let _=null;"visible"===document.visibilityState&&(_=c());let b=!1;setInterval(function(){++n>20&&(clearInterval(_),b=!0)},1e3),$(document).mousemove(function(i){b&&(_=c(),b=!1),n=0}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState?(clearInterval(_),b=!0):"visible"===document.visibilityState&&(_=c(),b=!1)}),window.onunload=function(){w("unload")}});