# Lab 300: Kubernetes REST Service Deployment

## Before You Begin
### Objectives
- Verify Kubernetes Cluster up and running.
- Find Deployed REST Services URLs.
- Verify REST Services deployed in Lab 300.
- Test REST services.
- Simulate Pod failure and REST service recovery.

### Introduction

Thus far on our journey from a monolithic application to microservices, we have created our supporting infrastructure, populated our database, and packaged our Java application as a Docker container and deploy it to our Kubernetes Cluster using Visual Studio. Now we need to verify all REST services that it will be accessible to our customers, as well as be manageable, observable, and scalable -- a Kubernetes cluster.

During this lab, you will verify REST Services deployed in Lab 300 via Kubernetes Dashboard.

## Required Artifacts

- You should already have completed labs 50, 100, and 200 before beginning this lab.

- **Works better with the Chrome browser**.

## **STEP 1**: Prerequisite: Add a Policy Statement for OKE

1. You should already have a browser tab logged in to the OCI Console. If you do not, log in again using the following URL.

    [https://cloud.oracle.com/en_US/sign-in](https://cloud.oracle.com/en_US/sign-in)

2.  Before the Oracle managed Kubernetes service can create compute instances in your OCI tenancy, we must explicitly give it permission to do so using a policy statement. From the OCI Console navigation menu, choose **Identity->Policies**.

  ![](images/300/LabGuide200-13c980fa.png)

3.  In the Compartment drop down menu on the left side, choose the **root compartment**. It will have the same name as your OCI tenancy (Cloud Account Name).

4.  Click **PSM-root-policy**

  ![](images/300/LabGuide200-e67b7705.png)

5.  Click the **Add Policy Statement** button

  ![](images/300/LabGuide200-3d4a7471.png)

6.  In the Statement box, enter the below statement and click **Add Statement**

  ```
  <copy>allow service OKE to manage all-resources in tenancy</copy>
  ```

  ![](images/300/LabGuide200-bd5bcbd1.png)

## **STEP 2**: Verify Kubernetes Cluster up and running.
1.  Navigate to Container Cluster (OKE).
  ![](images/300/300_1.png " ")
2.  Select the **AppDev** compartment and select **cluster1**.
  ![](images/300/300_2.png " ")
3.  Click **Access Cluster**.
  ![](images/300/300_3.png " ")
4.  Select **Lauch Cloud Shell** under Cloud Shell Access.
  ![](images/300/300_4.png " ")
5.  Wait for Attaching your Oracle Cloud Home Directory
  ![](images/300/300_5.png " ")
6.  You can see **Welcome to Oracle Cloud Shell**
  ![](images/300/300_6.png " ")
7.  To access the kubeconfig for your cluster, copy the following command to Cloud Shell
  ![](images/300/300_7.png " ")
8.  Paste it into Cloud Shell.
  ![](images/300/300_8.png " ")
9.  Check your new config file successfully created or merged.
  ![](images/300/300_9.png " ")
10.  Copy following command to see your cluster information
  ```
  <copy> kubectl cluster-info </copy>
  ```
  ![](images/300/300_10.png " ")
11.  Copy following command to see your worker nodes.
  ```
  <copy> kubectl get nodes </copy>
  ```
  ![](images/300/300_11.png " ")
12.  Click **Close**.
  ![](images/300/300_12.png " ")
## **STEP 3**: Find Deployed REST Services URLs.
1.  Copy following command and paste it to Cloud Shell to view deployed REST web-services
  ```
  <copy> kubectl get svc </copy>
  ```

  ![](images/300/OKE_Services.png " ") 

## **STEP 4**: Test REST services.
1.  Copy **product-svc** External endpoints. Append **/product/list** to External endpoints and paste it in your browser.
  ![](images/300/OKE_Services.png " ") 
2.  You can see all product available for the REST endpoint GET method.
  ![](images/300/300_30.png " ")
3.  You can also test product REST endpoint for a specific product as follows.

  ![](images/300/300_31.png " ")

## **STEP 5**: Simulate Pod failure and REST service recovery.
1.  Copy following command to get pods
  ```
  <copy> kubectl get pods </copy>
  ```
  ![](images/300/300_32.png " ")
2.  Copy product-svc pod name and append it following command to delete pod.
  ```
  <copy>kubectl delete pod pod_name </copy>
  ```
  ![](images/300/300_33.png " ")
3.  Copy following command and paste to see status of your pod you deleted. It has been deleted and re-created automatically.
  ```
  <copy> kubectl get pods </copy>
  ```
  ![](images/300/300_34.png " ")


Now that our REST service is deployed to Kubernetes, let's build a user interface on top of it so that end users can consume our product catalog and user catalog.

**This completes the Lab!**

**You are ready to proceed to** *Lab 400*

## Acknowledgements

- **Authors/Contributors** - Sasanka Abeysinghe
- **Last Updated By/Date** - 
- **Workshop Expiration Date** - May 31, 2021

See an issue?  Please open up a request [here](https://github.com/oracle/learning-library/issues).   Please include the workshop name and lab in your request. 