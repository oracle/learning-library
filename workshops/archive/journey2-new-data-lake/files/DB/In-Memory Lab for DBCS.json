{"paragraphs":[{"text":"%md\n# In-Memory Lab for DBCS\n\nThis Zeppelin notebook contains some runnable exercises to test the In-Memory option.\n\nRun this notebook one paragraph at a time from top to bottom.\n\nThis is a work-in-progress.  More verbose documentation will come later.\n\nDocumentation for Oracle In memory features can be found here: https://docs.oracle.com/database/122/INMEM/toc.htm.  \n\nPlease direct comments to: Ram Posham () /Sadhana avasarala (sadhana.avasarala@oracle.com)\n\n","dateUpdated":"2017-09-28T18:17:21+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>In-Memory Lab for DBCS</h1>\n<p>This Zeppelin notebook contains some runnable exercises to test the In-Memory option.</p>\n<p>Run this notebook one paragraph at a time from top to bottom.</p>\n<p>This is a work-in-progress. More verbose documentation will come later.</p>\n<p>Documentation for Oracle In memory features can be found here: <a href=\"https://docs.oracle.com/database/122/INMEM/toc.htm\">https://docs.oracle.com/database/122/INMEM/toc.htm</a>. </p>\n<p>Please direct comments to: Ram Posham () /Sadhana avasarala (<a href=\"mailto:&#x73;&#x61;d&#104;&#x61;&#x6e;&#97;&#46;&#97;&#118;&#97;&#x73;&#x61;&#114;&#97;&#108;&#97;&#x40;&#111;&#114;&#97;&#x63;&#108;&#101;&#x2e;&#99;&#x6f;&#x6d;\">&#x73;&#x61;d&#104;&#x61;&#x6e;&#97;&#46;&#97;&#118;&#97;&#x73;&#x61;&#114;&#97;&#108;&#97;&#x40;&#111;&#114;&#97;&#x63;&#108;&#101;&#x2e;&#99;&#x6f;&#x6d;</a>)</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1506622641536_-1227282705","id":"20170927-210424_11029088","dateCreated":"2017-09-28T18:17:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:254"},{"title":"See who we are, where we are, and explore our environment","text":"%sh\nwhoami\npwd\necho $ORACLE_HOME\nlsnrctl status\n","user":"anonymous","dateUpdated":"2017-09-28T18:18:12+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{"0":{"graph":{"mode":"table","height":414,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641550_-1231130194","id":"20170927-210435_1309709593","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:18:13+0000","dateFinished":"2017-09-28T18:18:14+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:255"},{"title":"Create Table spaces for loading the data","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset echo on\nset pages 999\nset timing on\nREM connect to PDB\nALTER SESSION SET container = PDB1;\nSHOW CON_NAME\nREM\ndrop tablespace ts_temp;\ncreate temporary tablespace ts_temp tempfile '/u02/app/oracle/oradata/ORCL/PDB1/ts_temp01.dbf' size 1G reuse autoextend on;\ndrop tablespace ts_data including contents and datafiles;\ncreate tablespace ts_data datafile '/u02/app/oracle/oradata/ORCL/PDB1/ts_data01.dbf' size 2G autoextend on;\nexit;\nEOF\n\nsqlplus / as sysdba @/tmp/mysql.sql\n","user":"anonymous","dateUpdated":"2017-09-28T18:25:17+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641559_-1222280969","id":"20170927-213725_1025132988","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:25:17+0000","dateFinished":"2017-09-28T18:26:03+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:256"},{"title":"Download data used for the lab","text":"%sh\nwget -nv -O /tmp/star-schema-benchmark-ssb.zip https://www.dropbox.com/s/vfea4snh8my3ngx/ssb.zip?dl=0\nls -l /tmp/star-schema-benchmark-ssb.zip\necho \"done\"","user":"anonymous","dateUpdated":"2017-09-28T18:26:36+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{"0":{"graph":{"mode":"table","height":93.15000915527344,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641560_-1224204714","id":"20170927-213246_2105535761","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:26:36+0000","dateFinished":"2017-09-28T18:27:22+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:257"},{"title":"Create the user ssb in the PDB","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset echo on\nset pages 999\nset timing on\nREM connect to PDB\nALTER SESSION SET container = PDB1;\nSHOW CON_NAME\nREM\ndrop user ssb cascade;\ncreate user ssb identified by ssb default tablespace ts_data temporary tablespace ts_temp;\ngrant dba to ssb;\nconnect ssb/ssb@PDB1\ncreate or replace directory expdumpdir1 as '/tmp';\nexit;\nEOF\n\nsqlplus / as sysdba @/tmp/mysql.sql\n","user":"anonymous","dateUpdated":"2017-09-28T18:28:04+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641561_-1224589462","id":"20170928-150747_1338690877","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:28:04+0000","dateFinished":"2017-09-28T18:28:05+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:258"},{"title":"Create Zeppelin JDBC connection for ssb user","text":"%sh\necho \"Script to set some zeppelin jdbc parameters\"\n\necho \"Set the User, Password, and ConnectString parameters in the script as appropriate\"\nUser=ssb\nPassword=ssb\nConnectString=\"localhost:1521/PDB1.gse00002281.oraclecloud.internal\"\n#echo $ConnectString\n\ncat <<EOF > /tmp/jdbc_settings.py\n#!/usr/local/bin/python\n#based on https://community.hortonworks.com/articles/36031/sample-code-to-automate-interacting-with-zeppelin.html by Ali Bajwa\ndef post_request(url, body):\n  import json, urllib2\n  encoded_body = json.dumps(body)\n  req = urllib2.Request(str(url), encoded_body)\n  req.get_method = lambda: 'PUT'\n  try:\n    response = urllib2.urlopen(req, encoded_body).read()\n  except urllib2.HTTPError, error:\n    print 'Exception: ' + error.read()\n  jsonresp = json.loads(response.decode('utf-8'))\n  print jsonresp['status']\n        \n \nimport json, urllib2\nzeppelin_int_url = 'http://127.0.0.1:9090/api/interpreter/setting/'\ndata = json.load(urllib2.urlopen(zeppelin_int_url))\nfor body in data['body']:\n  if body['group'] == 'jdbc':\n    jdbcbody = body\n  elif body['group'] == 'spark':\n    sparkbody = body    \n    \n \njdbcbody['properties']['orcl-$User.driver'] = 'oracle.jdbc.OracleDriver'\njdbcbody['properties']['orcl-$User.user'] = '$User'\njdbcbody['properties']['orcl-$User.password'] = '$Password'  \njdbcbody['properties']['orcl-$User.url'] = 'jdbc:oracle:thin:@//$ConnectString'\n\nmy_dict = {'groupArtifactVersion':  '/u01/app/oracle/product/12.1.0/dbhome_1/jdbc/lib/ojdbc7.jar',       'local': False}\njdbcbody['dependencies'].append(my_dict)\n\npost_request(zeppelin_int_url + jdbcbody['id'], jdbcbody)\nEOF\n#cat /tmp/jdbc_settings.py\necho \"..\"\npython /tmp/jdbc_settings.py\necho \"done\"","user":"anonymous","dateUpdated":"2017-09-28T18:28:30+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641563_-1223819965","id":"20170928-153143_1645007472","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:28:30+0000","dateFinished":"2017-09-28T18:28:30+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:259"},{"title":"Import the star schema table (will take about 8 minutes)","text":"%sh\ncd /tmp\nunzip star-schema-benchmark-ssb.zip\nimpdp ssb/ssb@PDB1 parallel=4 directory=expdumpdir1 exclude=USER schemas=ssb dumpfile=ssb%u.dmp;\n# clean up files to save space\nrm star-schema-benchmark-ssb.zip\nrm ssb01.dmp\nrm ssb02.dmp\nrm ssb03.dmp\nrm ssb04.dmp\necho \"done\"","user":"anonymous","dateUpdated":"2017-09-29T13:26:30+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641565_-1226128458","id":"20170928-151446_1343995154","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-29T13:26:30+0000","dateFinished":"2017-09-29T13:26:36+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:260"},{"text":"%jdbc(orcl-ssb)\nselect * from user_tables\n","user":"anonymous","dateUpdated":"2017-09-29T13:27:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506691610894_-1324984397","id":"20170929-132650_311428004","dateCreated":"2017-09-29T13:26:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1194","dateFinished":"2017-09-29T13:27:51+0000","dateStarted":"2017-09-29T13:27:37+0000","errorMessage":""},{"title":"Allocate memory for column store and restart database.","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset echo on\nalter system set memory_target=4608M scope=spfile;\nalter system set memory_max_target=4608M scope=spfile;\nalter system set sga_max_size=3584M scope=spfile;\nalter system set inmemory_size=1536M scope=spfile;\nstartup force;\nexit;\nEOF\n\nsqlplus / as sysdba @/tmp/mysql.sql\n\n","user":"anonymous","dateUpdated":"2017-09-28T18:37:20+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641566_-1224974211","id":"20170928-151519_1603351131","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:37:20+0000","dateFinished":"2017-09-28T18:37:41+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:261"},{"title":"Buffer Cache ssb tables (for comparison to inmemory columnar)","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset echo on\nalter table PART cache;\nalter table CUSTOMER cache;\nalter table SUPPLIER cache;\nalter table LINEORDER cache;\nalter table DATE_DIM cache;\nexit;\nEOF\n\nsqlplus ssb/ssb@PDB1 @/tmp/mysql.sql","user":"anonymous","dateUpdated":"2017-09-28T18:38:05+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641568_-1239594670","id":"20170928-152327_714661301","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:38:06+0000","dateFinished":"2017-09-28T18:38:06+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:262"},{"title":"Store the ssb schema tables in IN-MEMORY columnar","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset echo on\nalter table PART inmemory;\nalter table CUSTOMER inmemory;\nalter table SUPPLIER inmemory;\nalter table LINEORDER inmemory;\nalter table DATE_DIM inmemory;\nexit;\nEOF\n\nsqlplus ssb/ssb@PDB1 @/tmp/mysql.sql","user":"anonymous","dateUpdated":"2017-09-28T18:38:23+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641569_-1239979418","id":"20170928-152524_975023108","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:38:23+0000","dateFinished":"2017-09-28T18:38:24+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:263"},{"title":"Verify inmemory settings","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset lines 100\nset echo on\nshow sga\nshow parameter inmemory\nselect * from v\\$inmemory_area;\nselect v.owner, v.segment_name name, v.populate_status status\nFROM v\\$im_segments v;\nexit;\nEOF\n# note use of \\$ to escape $ from the shell\n\nsqlplus ssb/ssb@PDB1 @/tmp/mysql.sql\n","user":"anonymous","dateUpdated":"2017-09-28T18:39:37+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641570_-1238825172","id":"20170928-152607_148836232","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:39:38+0000","dateFinished":"2017-09-28T18:39:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:264"},{"title":"Populate inmemory store and buffer cache","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset timing on\nset echo on\nSELECT /*+ full(d) noparallel (d )*/ Count(*) FROM date_dim d;\nSELECT /*+ full(s) noparallel (s )*/ Count(*) FROM supplier s;\nSELECT /*+ full(p) noparallel (p )*/ Count(*) FROM part p;\nSELECT /*+ full(c) noparallel (c )*/ Count(*) FROM customer c;\nSELECT /*+ full(lo) noparallel (lo )*/ Count(*) FROM lineorder lo;\nexit;\nEOF\n# note use of \\$ to escape $ from the shell\n\nsqlplus ssb/ssb@PDB1 @/tmp/mysql.sql\n","user":"anonymous","dateUpdated":"2017-09-28T18:40:16+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641572_-1241133665","id":"20170928-152727_1526606917","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:40:16+0000","dateFinished":"2017-09-28T18:40:28+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:265"},{"title":"Verify compression status and data in memory","text":"%jdbc(orcl-ssb)\nSELECT v.owner, v.segment_name,\nv.bytes orig_size,\nv.inmemory_size in_mem_size,\nROUND(v.bytes / v.inmemory_size, 2) comp_ratio\nFROM v$im_segments v\nORDER BY 5;\n","user":"anonymous","dateUpdated":"2017-09-28T18:40:42+0000","config":{"editorSetting":{"language":"text","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/text","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641573_-1241518414","id":"20170928-152949_206319444","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:40:42+0000","dateFinished":"2017-09-28T18:41:00+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:266"},{"title":"Time a query with and without inmemory_query","text":"%sh\ncat <<EOF > /tmp/mysql.sql\nset pages 999\nset timing on\nset echo on\nPROMPT run query with inmemory query enabled\nSELECT d.d_year, c.c_nation, SUM(lo_revenue - lo_supplycost) profit FROM lineorder l, date_dim d,part p,\nsupplier s,customer c  \nWHERE l.lo_orderdate = d.d_datekey\nAND l.lo_partkey = p.p_partkey\nAND l.lo_suppkey = s.s_suppkey\nAND l.lo_custkey = c.c_custkey\nAND s.s_region = 'AMERICA'\nAND c.c_region = 'AMERICA'\nGROUP BY d.d_year, c.c_nation\nORDER BY d.d_year, c.c_nation;\nREM\nREM\nPROMPT run query with inmemory query disabled\nalter session set inmemory_query=disable;\nSELECT d.d_year, c.c_nation, SUM(lo_revenue - lo_supplycost) profit FROM lineorder l, date_dim d,part p,\nsupplier s,customer c  \nWHERE l.lo_orderdate = d.d_datekey\nAND l.lo_partkey = p.p_partkey\nAND l.lo_suppkey = s.s_suppkey\nAND l.lo_custkey = c.c_custkey\nAND s.s_region = 'AMERICA'\nAND c.c_region = 'AMERICA'\nGROUP BY d.d_year, c.c_nation\nORDER BY d.d_year, c.c_nation;\nexit;\nEOF\n# note use of \\$ to escape $ from the shell\n\nsqlplus ssb/ssb@PDB1 @/tmp/mysql.sql","user":"anonymous","dateUpdated":"2017-09-28T18:41:47+0000","config":{"editorSetting":{"language":"sh","editOnDblClick":false},"colWidth":12,"editorMode":"ace/mode/sh","title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641574_-1240364167","id":"20170928-153645_835869772","dateCreated":"2017-09-28T18:17:21+0000","dateStarted":"2017-09-28T18:41:48+0000","dateFinished":"2017-09-28T18:42:15+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:267"},{"text":"%sh\n","dateUpdated":"2017-09-28T18:17:21+0000","config":{"colWidth":12,"editorMode":"ace/mode/sh","results":{},"enabled":true,"editorSetting":{"language":"sh","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1506622641576_-1242672661","id":"20170928-153858_1593582360","dateCreated":"2017-09-28T18:17:21+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:268"}],"name":"In-Memory Lab for DBCS","id":"2CW5G1TD6","angularObjects":{"2CX1QKEP3:shared_process":[],"2CWQZHUAK:shared_process":[],"2CUTRMX8H:shared_process":[],"2CVPD6X4D:shared_process":[],"2CVUXV6CU:shared_process":[],"2CWWY9BRX:shared_process":[],"2CTAQM21H:shared_process":[],"2CVDF3DVD:shared_process":[],"2CW3C3P84:shared_process":[],"2CWR5T9PH:shared_process":[],"2CTBHWNZG:shared_process":[],"2CVRSY2GC:shared_process":[],"2CW6J62DH:shared_process":[],"2CUAE9ANC:shared_process":[],"2CX19ZZEX:shared_process":[],"2CX2SQRS9:shared_process":[],"2CUKMPWJQ:shared_process":[],"2CVX5NDGR:shared_process":[],"2CTSA1DDE:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}