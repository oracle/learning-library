{"paragraphs":[{"text":"%md\n# Demonstration: Citi Bike New York - Download Data\n\nThis tutorial was built for BDCS-CE version 17.3.1. If you are using a later version of BDCS-CE, there may be a newer version of this tutorial notebook at <https://github.com/oracle/learning-library/tree/master/workshops/journey2-new-data-lake> . Questions and feedback about the tutorial: david.bayard@oracle.com\n\n## Contents\n+ About Citi Bike New York City\n+ Downloading data and storing in the Object Store\n+ Next Steps\n\nAs a reminder, the documentation for BDCS-CE can be found here: <http://docs.oracle.com/cloud/latest/big-data-compute-cloud/index.html>","user":"anonymous","dateUpdated":"2017-07-28T00:45:04+0000","config":{"editorSetting":{"editOnDblClick":"true","language":"markdown"},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Demonstration: Citi Bike New York - Download Data</h1>\n<p>This tutorial was built for BDCS-CE version 17.3.1. If you are using a later version of BDCS-CE, there may be a newer version of this tutorial notebook at <a href=\"https://github.com/oracle/learning-library/tree/master/workshops/journey2-new-data-lake\">https://github.com/oracle/learning-library/tree/master/workshops/journey2-new-data-lake</a> . Questions and feedback about the tutorial: <a href=\"mailto:&#100;&#97;&#118;&#x69;&#100;&#46;&#x62;&#97;&#x79;&#x61;&#x72;&#x64;&#64;&#x6f;&#114;&#97;c&#108;&#x65;&#x2e;c&#x6f;&#109;\">&#100;&#97;&#118;&#x69;&#100;&#46;&#x62;&#97;&#x79;&#x61;&#x72;&#x64;&#64;&#x6f;&#114;&#97;c&#108;&#x65;&#x2e;c&#x6f;&#109;</a></p>\n<h2>Contents</h2>\n<ul>\n  <li>About Citi Bike New York City</li>\n  <li>Downloading data and storing in the Object Store</li>\n  <li>Next Steps</li>\n</ul>\n<p>As a reminder, the documentation for BDCS-CE can be found here: <a href=\"http://docs.oracle.com/cloud/latest/big-data-compute-cloud/index.html\">http://docs.oracle.com/cloud/latest/big-data-compute-cloud/index.html</a></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1501202673318_-1245233008","id":"20170414-131903_889251720","dateCreated":"2017-07-28T00:44:33+0000","dateStarted":"2017-07-28T00:45:04+0000","dateFinished":"2017-07-28T00:45:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:306"},{"text":"%md\n# About Citi Bike New York City\n\nThis demonstration uses bike ride data available from the New York City bike share program known as Citi Bike NYC.  Citi Bike consists of a fleet of bikes and a network of docking stations.  Bikes can be unlocked from one station and returned to any other.  Details about Citi Bike can be found here: <https://www.citibikenyc.com/>.\n\nParts of this demonstration are inspired by this analysis: <http://toddwschneider.com/posts/a-tale-of-twenty-two-million-citi-bikes-analyzing-the-nyc-bike-share-system/>\n\n\n\n","user":"anonymous","dateUpdated":"2017-07-28T00:45:12+0000","config":{"editorSetting":{"editOnDblClick":"true","language":"markdown"},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>About Citi Bike New York City</h1>\n<p>This demonstration uses bike ride data available from the New York City bike share program known as Citi Bike NYC. Citi Bike consists of a fleet of bikes and a network of docking stations. Bikes can be unlocked from one station and returned to any other. Details about Citi Bike can be found here: <a href=\"https://www.citibikenyc.com/\">https://www.citibikenyc.com/</a>.</p>\n<p>Parts of this demonstration are inspired by this analysis: <a href=\"http://toddwschneider.com/posts/a-tale-of-twenty-two-million-citi-bikes-analyzing-the-nyc-bike-share-system/\">http://toddwschneider.com/posts/a-tale-of-twenty-two-million-citi-bikes-analyzing-the-nyc-bike-share-system/</a></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1501202673319_-1245617757","id":"20170414-131917_125800834","dateCreated":"2017-07-28T00:44:33+0000","dateStarted":"2017-07-28T00:45:12+0000","dateFinished":"2017-07-28T00:45:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:307"},{"text":"%md\n# Downloading data and Storing in Object Store\n\nThe first step will be to download a month of data.  We will get our data from <https://www.citibikenyc.com/system-data>.  By default, we will grab data for December 2016.\n\nOnce the data is downloaded, we will unzip it.  Finally, we will store the unzipped data into a container in Object Store.  The container does not need to exist-- the code will create it if needed.  By default, the container will be named \"citibike\".\n\nWith BDCS-CE, you can choose to store your data in HDFS and/or the Object Store.  With this tutorial, we will show how to use the very scalable and economical Object Store to store our data.  More details about the Object Store are available in the \"Working with the Object Store\" tutorial.\n\nHere is a logical diagram of the architecture we will use in these tutorials:\n![Architecture](https://raw.githubusercontent.com/oracle/learning-library/master/workshops/journey2-new-data-lake/images/snap0012028.jpg)\n\n","user":"anonymous","dateUpdated":"2017-07-28T00:45:18+0000","config":{"editorSetting":{"editOnDblClick":"true","language":"markdown"},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Downloading data and Storing in Object Store</h1>\n<p>The first step will be to download a month of data. We will get our data from <a href=\"https://www.citibikenyc.com/system-data\">https://www.citibikenyc.com/system-data</a>. By default, we will grab data for December 2016.</p>\n<p>Once the data is downloaded, we will unzip it. Finally, we will store the unzipped data into a container in Object Store. The container does not need to exist&ndash; the code will create it if needed. By default, the container will be named &ldquo;citibike&rdquo;.</p>\n<p>With BDCS-CE, you can choose to store your data in HDFS and/or the Object Store. With this tutorial, we will show how to use the very scalable and economical Object Store to store our data. More details about the Object Store are available in the &ldquo;Working with the Object Store&rdquo; tutorial.</p>\n<p>Here is a logical diagram of the architecture we will use in these tutorials:<br/><img src=\"https://raw.githubusercontent.com/oracle/learning-library/master/workshops/journey2-new-data-lake/images/snap0012028.jpg\" alt=\"Architecture\" /></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1501202673319_-1245617757","id":"20170417-082204_1964276013","dateCreated":"2017-07-28T00:44:33+0000","dateStarted":"2017-07-28T00:45:18+0000","dateFinished":"2017-07-28T00:45:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:308"},{"title":"Shell commands to download data and copy data to Object Storage","text":"%sh\n\n# If you get a http 403 permission denied error and you are using 17.3.1-20, you might be hitting an issue with an incorrect setting in /etc/hadoop/conf/core-site.xml\n# If you get the error, run this command:\n# grep service.default.auth.url /etc/hadoop/conf/core-site.xml\n# If the command has values like: https://storage.us2.oraclecloud.com/auth/v2.0/tokens, you may have this issue.  \n# The fix is to SSH to the server, edit /etc/hadoop/conf/core-site.xml and change the values to https://DOMAINID.storage.oraclecloud.com/auth/v2.0/tokens, where DOMAINID is a value like gse00011916 or a034212\n# Then restart the notebook\n\nCONTAINER=citibike\nFILENAME=201612-citibike-tripdata\n\necho \"Object Storage Container Name        :\" $CONTAINER\necho \"Data Set name (remove .zip or .csv)  :\" $FILENAME\necho \"-----------------------------------------------------------------\"\n\ntest -e $CONTAINER || mkdir $CONTAINER\ncd $CONTAINER\nrm $FILENAME*\n\necho \"Downloading $FILENAME.zip.  This may take a few minutes.\"\n# https://www.citibikenyc.com/system-data links us to https://s3.amazonaws.com/tripdata/\nwget https://s3.amazonaws.com/tripdata/$FILENAME.zip \necho \"Extracting the csv from the zip file\"\nunzip $FILENAME.zip\n#head -3 $FILENAME.csv\necho \"Creating a new version of the file without header information named _nh.csv\"\nsed '1d' $FILENAME.csv > ${FILENAME}_nh.csv\nls -l\n\necho \"Storing both versions of the csv files to Object Storage.  This may take a few minutes.\"\n# we use the hadoop swift:// driver to interact with the Object Store.\n# The .default configuration of the swift driver is the object store connection you defined when you created the BDCSCE instance.\n# Immediately Delete old files and directory if it is there do not put in Trash\nhadoop fs -rm -r -skipTrash swift://$CONTAINER.default/* 2>&1\nhadoop fs -rmdir -skipTrash swift://$CONTAINER.default/ 2>&1\necho \"List the directory contents should be empty\"\nhadoop fs -ls swift://$CONTAINER.default/ 2>&1\necho \"Make the directory in Object Store\"\nhadoop fs -mkdir swift://$CONTAINER.default/ 2>&1\necho \"Copy First File to Object Store\"\nhadoop fs -put $FILENAME.csv swift://$CONTAINER.default/$FILENAME.csv 2>&1\necho \"List contents of Object Store\"\nhadoop fs -ls swift://$CONTAINER.default/ 2>&1\necho \"Copy Second File to Object Store\"\nhadoop fs -put ${FILENAME}_nh.csv swift://$CONTAINER.default/${FILENAME}_nh.csv 2>&1\necho \"Validate by listing the 2 csv files that got copied to Object Store (you should see 2 .csv files)\"\nhadoop fs -ls swift://$CONTAINER.default/ 2>&1\necho \"done\"\n","user":"anonymous","dateUpdated":"2017-07-28T12:59:46+0000","config":{"tableHide":false,"editorSetting":{"editOnDblClick":"false","language":"sh"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"title":true,"results":{},"graph":{"mode":"table","height":424,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{"container":"dcb-bdcs-apr12","CONTAINER":"citibike","FILENAME":"201612-citibike-tripdata","datafile":"","FILENAME%%.*":""},"forms":{"FILENAME":{"name":"FILENAME","defaultValue":"","hidden":false,"$$hashKey":"object:458"}}},"apps":[],"jobName":"paragraph_1501202673320_-1247541502","id":"20170417-082204_2139066596","dateCreated":"2017-07-28T00:44:33+0000","dateStarted":"2017-07-28T12:55:51+0000","dateFinished":"2017-07-28T12:57:33+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:309"},{"text":"%md\n# Next Steps\n\nSo far, we have downloaded a Citi Bike data zip and created csv files. Then we stored the data into an Object Storage container. \n\nIn the next part of the Demo, we set up a Hive and Spark tables using the CSV files\n\n\n","user":"anonymous","dateUpdated":"2017-07-28T00:45:26+0000","config":{"editorSetting":{"editOnDblClick":"true","language":"markdown"},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[{"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}}}],"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Next Steps</h1>\n<p>So far, we have downloaded a Citi Bike data zip and created csv files. Then we stored the data into an Object Storage container. </p>\n<p>In the next part of the Demo, we set up a Hive and Spark tables using the CSV files</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1501202673320_-1247541502","id":"20170417-103925_248941849","dateCreated":"2017-07-28T00:44:33+0000","dateStarted":"2017-07-28T00:45:26+0000","dateFinished":"2017-07-28T00:45:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:310"},{"text":"%md\n### Change Log\nJuly 28, 2017 - Confirmed that it works with 17.3.1-20.\nJuly 31, 2017 - Added comments about 17.3.1-20 core-site.xml swift auth url issue that affects some users.","user":"anonymous","dateUpdated":"2017-07-31T18:58:11+0000","config":{"editorSetting":{"language":"markdown","editOnDblClick":"true"},"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"results":[],"enabled":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h3>Change Log</h3>\n<p>July 28, 2017 - Confirmed that it works with 17.3.1-20.<br/>July 31, 2017 - Added comments about 17.3.1-20 core-site.xml swift auth url issue that affects some users.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1501202673320_-1247541502","id":"20170503-195744_526374432","dateCreated":"2017-07-28T00:44:33+0000","dateStarted":"2017-07-31T18:58:11+0000","dateFinished":"2017-07-31T18:58:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:311"},{"text":"%md\n","user":"anonymous","dateUpdated":"2017-07-28T13:00:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":"true"},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1501246801461_-1578935737","id":"20170728-130001_1327783603","dateCreated":"2017-07-28T13:00:01+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:312"}],"name":"Tutorial 3 Citi Bike New York Introduction and Setup","id":"2CRSAM7Z8","angularObjects":{"2CQVFQFWU:shared_process":[],"2CRFREMNU:shared_process":[],"2CPRZVQKR:shared_process":[],"2CQWU46XZ:shared_process":[],"2CPKCF4R9:shared_process":[],"2CR7Y2CFK:shared_process":[],"2CQQM64RT:shared_process":[],"2CQX3UW3S:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}